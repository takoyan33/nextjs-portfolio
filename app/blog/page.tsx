import type { Metadata } from "next"
import { PATH } from "../../utils/path"
import type { zennProps } from "../../utils/type"
import { BreadList, LowerTitle } from "../components/ui/"
import ZennArticleItem from "../components/ui/ZennArticleItem"

export const metadata: Metadata = {
	title: "To You Design - Blog",
	description: "Generated by Next.js",
}

const Blog = async () => {
	let zennArticles: zennProps | null = null

	try {
		const response = await fetch(
			"https://zenn.dev/api/articles?username=643866",
		)
		console.log(response)
		if (!response.ok) {
			throw new Error(`Failed to fetch Zenn articles: ${response.status}`)
		}
		zennArticles = await response.json()
	} catch (err) {
		console.error(err)
	}

	zennArticles?.articles.sort((a, b) => {
		return (
			new Date(b.published_at).getTime() - new Date(a.published_at).getTime()
		)
	})

	return (
		<main>
			<div className="max_width">
				<BreadList name="Blog" link={PATH.BLOG} />
			</div>
			<LowerTitle title="Blog" enTitle="ブログ" />
			<div className="max_width">
				<h3 className="portfolio__headTitle">
					Zenn
					<span className="portfolio__headTitle-span">
						{zennArticles?.articles.length}件
					</span>
				</h3>
				<div className="flx padding">
					{zennArticles?.articles.map((article) => (
						<ZennArticleItem
							key={article.id}
							zenn_id={article.id}
							zenn_title={article.title}
							zenn_published_at={article.published_at}
							zenn_article_type={article.article_type}
							zenn_emoji={article.emoji}
							zenn_path={article.path}
						/>
					))}
				</div>
			</div>
		</main>
	)
}

export default Blog
